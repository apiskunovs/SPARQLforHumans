<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width">
    <title>SparqlForHumans.Blazor</title>
    <base href="/" />

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/fontawesome.css" integrity="sha384-GVa9GOgVQgOk+TNYXu7S/InPTfSDTtBalSgkgqQ7sCik56N9ztlkoTr2f/T44oKV" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/solid.css" integrity="sha384-Rw5qeepMFvJVEZdSo1nDQD5B6wX0m7c5Z/pLNvjkB14W6Yki1hKbSEQaX9ffUbWe" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/regular.css" integrity="sha384-EWu6DiBz01XlR6XGsVuabDMbDN6RT8cwNoY+3tIH+6pUCfaNldJYJQfQlbEIWLyA" crossorigin="anonymous">
    <link rel="stylesheet" href="lib/css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/site.css" />
    <script src="lib/js/jquery.min.js"></script>
    <script src="lib/jquery-ui.min.js"></script>
    <script src="lib/js/bootstrap.min.js"></script>
    <script src="lib/js/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>
</head>
<body>
    <app>Loading...</app>

    <script src="_framework/blazor.server.js"></script>

    <script>
        var lastFunc;
        var lastRan;

        window.autoCompleteElement = {

            //Returns a function, that, as long as it continues to be invoked, will not
            //be triggered. The function will be called after it stops being called for
            //N milliseconds. If `immediate` is passed, trigger the function on the
            //leading edge, instead of the trailing.
            debounce: function (dotnetElementReference, functionName, wait, arg) {

                if (!lastRan) {
                    //dotnetElementReference.invokeMethodAsync(functionName, arg);
                    lastRan = Date.now();
                } else {
                    clearTimeout(lastFunc);
                    lastFunc = setTimeout(function() {
                        if ((Date.now() - lastRan) >= wait) {
                                dotnetElementReference.invokeMethodAsync(functionName, arg);
                                lastRan = Date.now();
                            }
                        },
                        wait - (Date.now() - lastRan));
                }

                //var inDebounce;
                //clearTimeout(inDebounce);
                //inDebounce = setTimeout(() => dotnetElementReference.invokeMethodAsync(functionName, "bbb"), wait)

                //executeThing = false;
                //var later = function () {
                //    timeout = null;
                //    if (!immediate) {
                //        dotnetElementReference.invokeMethodAsync(functionName, "bbb");
                //        executeThing = true;
                //    }
                //};

                //var callNow = immediate && !timeout;
                //clearTimeout(timeout);
                //timeout = setTimeout(later, wait);

                //if (callNow) {
                //    dotnetElementReference.invokeMethodAsync(functionName, "aaa");

                //}
                //func.apply(context, args);
            },

            setSourceFunction: function (elementRef, dotnetElementReference) {

                var _function = function (request, response) {
                    var list = dotnetElementReference.invokeMethodAsync("AutocompleteSourceDelegate", request.term);
                    list.then(function (x) {
                        response(x);
                    });
                };

                $(elementRef).autocomplete('option', 'source', _function);
            },

            setMinLength: function (elementRef, minLength) {

                $(elementRef).autocomplete('option', 'minLength', minLength);
            },

            setDelay: function (elementRef, delay) {

                $(elementRef).autocomplete('option', 'delay', delay);
            },

            initAutoComplete: function (elementRef) {

                $(elementRef).autocomplete({
                    source: ['Source function not set'],
                    minLength: 1,
                    delay: 400,
                    focus: function (event, ui) {
                        event.preventDefault();
                        $(this).val(ui.item.label);
                    },
                    create: function () {
                        $(this).data('ui-autocomplete')._renderItem = function (ul, item) {
                            ul.css("overflow-x", "auto");
                            ul.css("overflow-y", "scroll");
                            ul.css("max-height", "300px");
                            return $("<li class='list-group-item list-group-item-action' style='max-width: 400px' >")
                                .append("<div'>" + item.label + " (" + item.value.id + ") </div>")
                                .appendTo(ul);
                        };
                    },
                });
            },

            setSelect: function (elementRef, dotnetElementReference) {

                var _function = function (event, ui) {
                    event.preventDefault();
                    dotnetElementReference.invokeMethodAsync("OnSelectEventListener", ui.item.value);
                };

                $(elementRef).on("autocompleteselect", _function);

            }


        };
    </script>
</body>
</html>
